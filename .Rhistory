hist(F)
hist(harvst)
log_f = rnorm(1000, 0.3, 0.1)
F = exp(log_f)
fish = 500
harvst = 500* (1-exp(-F))
hist(harvst)
log_f = rnorm(1000, 0.5, 0.1)
F = exp(log_f)
fish = 500
harvst = 500* (1-exp(-F))
hist(harvst)
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
## harvest ======
pred_N_harvest <- summary(bh_fit, pars = c("N_catch"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
## harvest ======
pred_N_harvest <- summary(bh_fit, pars = c("N_catch"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
## juveniles ======
# multiply by catch q to fit observations
catch_q <- summary(bh_fit, pars = c("log_catch_q"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
mutate(mean = exp(mean))
pred_N_j <- summary(bh_fit, pars = c("N_j"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = 1:nrow(.))
# plot proportions
# sum to compare with data
summ_n_j <- pred_N_j %>%
dplyr::mutate(mean_J_Q = mean*catch_q$mean,
se_mean = se_mean*catch_q$mean) %>%
cbind(obs = data_list_stan$data_stage_j) #%>%
ggplot(data = summ_n_j) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = mean_J_Q)) +
geom_ribbon(aes(x=time, ymin = mean_J_Q-se_mean,
ymax = mean_J_Q+se_mean), alpha = 0.5)+
ggtitle(("Juveniles, est and observed"))
# plot time series of estimated fishing mortality ======
fishing <- summary(bh_fit, pars = c("log_F"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
mutate(mean = exp(mean),
time = 1:nrow(.))
ggplot(data = fishing) +
geom_line(aes(x=time, y = mean)) +
geom_ribbon(aes(x=time, ymin = mean-se_mean,
ymax = mean+se_mean), alpha = 0.5) +
ylab("Log fishing")
# parameter plots ========
plot(bh_fit, show_density = FALSE, ci_level = 0.95,
pars=  c( "D_scale", "theta1[1]","theta1[2]","theta2[1]"),
fill_color = "blue")
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
# parameter plots ========
plot(bh_fit, show_density = FALSE, ci_level = 0.95,
pars=  c( "D_scale", "theta1[1]","theta1[2]","theta2[1]"),
fill_color = "blue")
plot(bh_fit, show_density = FALSE, ci_level = 0.95,
pars=  c( "prob[1]", "prob[2]","prob[3]", "basal_p_1", "basal_p_2"),
fill_color = "blue")
plot(bh_fit, show_density = FALSE, ci_level = 0.95,
pars=  c( "p_1"),
fill_color = "blue")
plot(bh_fit, show_density = FALSE, ci_level = 0.95,
pars=  c( "p_2"),
fill_color = "blue")
## harvest ======
pred_N_harvest <- summary(bh_fit, pars = c("N_catch"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
## harvest ======
pred_N_harvest <- summary(bh_fit, pars = c("N_catch"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
log(0.1)
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
## harvest ======
pred_N_harvest <- summary(bh_fit, pars = c("N_catch"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
## harvest ======
pred_N_harvest <- summary(bh_fit, pars = c("N_catch"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
# Plot Observed vs Predicted ========
## Spawners ==========
pred_N_SP <- summary(bh_fit, pars = c("N_sp"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21) # remove years without full return estiamtes
# plt proportions
# sum to comarpe with data
summ_n_sp <- pred_N_SP %>%
group_by(time) %>%
summarise(pred_n_sp = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_sp)
ggplot(data = summ_n_sp) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_sp)) +
geom_ribbon(aes(x=time, ymin = pred_n_sp-pred_se,
ymax = pred_n_sp+pred_se))
## recruits ======
pred_N_recruit <- summary(bh_fit, pars = c("N_recruit"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_rec <- pred_N_recruit %>%
group_by(time) %>%
summarise(pred_n_rec = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_return)
ggplot(data = summ_n_rec) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_rec)) +
geom_ribbon(aes(x=time, ymin = pred_n_rec-pred_se,
ymax = pred_n_rec+pred_se))+
ggtitle(("Recruits, est and observed"))
## harvest ======
pred_N_harvest <- summary(bh_fit, pars = c("N_catch"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
## juveniles ======
# multiply by catch q to fit observations
catch_q <- summary(bh_fit, pars = c("log_catch_q"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
mutate(mean = exp(mean))
pred_N_j <- summary(bh_fit, pars = c("N_j"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = 1:nrow(.))
# plot proportions
# sum to compare with data
summ_n_j <- pred_N_j %>%
dplyr::mutate(mean_J_Q = mean*catch_q$mean,
se_mean = se_mean*catch_q$mean) %>%
cbind(obs = data_list_stan$data_stage_j) #%>%
ggplot(data = summ_n_j) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = mean_J_Q)) +
geom_ribbon(aes(x=time, ymin = mean_J_Q-se_mean,
ymax = mean_J_Q+se_mean), alpha = 0.5)+
ggtitle(("Juveniles, est and observed"))
# plot time series of estimated fishing mortality ======
fishing <- summary(bh_fit, pars = c("log_F"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
mutate(mean = exp(mean),
time = 1:nrow(.))
ggplot(data = fishing) +
geom_line(aes(x=time, y = mean)) +
geom_ribbon(aes(x=time, ymin = mean-se_mean,
ymax = mean+se_mean), alpha = 0.5) +
ylab("Log fishing")
exp(-1)
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
# plot time series of estimated fishing mortality ======
fishing <- summary(bh_fit, pars = c("log_F"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
mutate(mean = exp(mean),
time = 1:nrow(.))
ggplot(data = fishing) +
geom_line(aes(x=time, y = mean)) +
geom_ribbon(aes(x=time, ymin = mean-se_mean,
ymax = mean+se_mean), alpha = 0.5) +
ylab("Log fishing")
# plot time series of estimated fishing mortality ======
fishing <- summary(bh_fit, pars = c("log_F"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
mutate(mean =  (mean),
time = 1:nrow(.))
ggplot(data = fishing) +
geom_line(aes(x=time, y = mean)) +
geom_ribbon(aes(x=time, ymin = mean-se_mean,
ymax = mean+se_mean), alpha = 0.5) +
ylab("Fm")
# plot time series of estimated fishing mortality ======
fishing <- summary(bh_fit, pars = c("log_F"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
mutate(mean = exp(mean),
time = 1:nrow(.))
ggplot(data = fishing) +
geom_line(aes(x=time, y = mean)) +
geom_ribbon(aes(x=time, ymin = mean-se_mean,
ymax = mean+se_mean), alpha = 0.5) +
ylab("Fm")
## harvest ======
pred_N_harvest <- summary(bh_fit, pars = c("N_catch"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
## harvest ======
pred_N_harvest <- summary(bh_fit, pars = c("N_catch"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
bh_fit <- stan(
file = here::here("scripts", "stan_mod_BH_dat.stan"),
data = data_list_stan,
chains = 1,#n_chains,
warmup = warmups,
iter = total_iterations,
cores = n_cores)
write_rds(bh_fit, "output/stan_fit_DATA.RDS")
## harvest ======
pred_N_harvest <- summary(bh_fit, pars = c("N_catch"),
probs = c(0.1, 0.9))$summary %>%
data.frame() %>%
rownames_to_column()  %>%
dplyr::mutate(time = rep(1:25, each=4),
age = rep(1:4, length.out = nrow(.))) %>%
filter(!time>21)
# sum to compare with data
summ_n_harvest <- pred_N_harvest %>%
group_by(time) %>%
summarise(pred_n_harvest = sum(mean),
pred_se = mean(se_mean)) %>%
cbind(obs = data_list_stan$data_stage_harvest)
ggplot(data = summ_n_harvest) +
geom_point(aes(x=time, y = obs)) +
geom_line(aes(x=time, y = pred_n_harvest)) +
geom_ribbon(aes(x=time, ymin = pred_n_harvest-pred_se,
ymax = pred_n_harvest+pred_se))+
ggtitle(("Harvest, est and observed"))
