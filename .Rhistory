ggsave("output/Plot_Supplement_Covariate_Sensitivity.png", width = 10, height = 4)
joined_stage_b <- left_join(stage_b_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(full_mod_median-reduced_mod_median)/full_mod_median,
relative_diff = (full_mod_median-reduced_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
dplyr::mutate(switch = case_when(reduced_mod_median < 0 & full_mod_median < 0 ~ "N",
reduced_mod_median > 0 & full_mod_median > 0 ~ "N",
TRUE ~ "Y"),
covariate_removed = case_when(covariate_removed== "SST_CDD_Aleut" ~ "CDD SST-Aleut",
covariate_removed== "Chum_hatchery" ~ "Chum Hatchery Abund.",
covariate_removed== "full_index" ~ "Fullness Index"),
variable = case_when(variable== "Aleutian Winter Temperature" ~ "CDD SST-ALeut",
variable== "Chum Salmon Hatchery Release Abundance" ~ "Chum Hatchery Abund.",
variable== "Mean Return Size" ~ "Mean Spawner Size",
variable== "Winter Snowpack" ~ "Winter Snowpack",
TRUE ~ variable),
covariate_removed = factor(covariate_removed,
levels = c("Fullness Index","CDD SST-Aleut",
"Chum Hatchery Abund.")),
variable = factor(variable, levels = c("Fullness Index","CDD SST-ALeut",
"Chum Hatchery Abund.")))
View(joined_stage_b)
## DFs with percent and relative diff  =======
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
dplyr::mutate(switch = case_when(reduced_mod_median < 0 & full_mod_median <0 ~ "N",
reduced_mod_median > 0 & full_mod_median >0 ~ "N",
TRUE ~ "Y"),
covariate_removed = case_when(covariate_removed== "SST_CDD_NBS" ~ "CDD SST-NBS",
covariate_removed== "yukon_mean_discharge" ~ "Yukon River - Mean Flow",
covariate_removed== "pollock_recruit_scale" ~ "Pollock Recruit. Index",
covariate_removed== "mean_size" ~ "Mean Spawner Size",
covariate_removed== "fall_snow_cummulative" ~ "Winter Snowpack"))
View(joined_stage_a)
## DFs with percent and relative diff  =======
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
dplyr::mutate(switch = case_when(reduced_mod_median < 0 & full_mod_median <0 ~ "N",
reduced_mod_median > 0 & full_mod_median >0 ~ "N",
TRUE ~ "Y"),
covariate_removed = case_when(covariate_removed== "SST_CDD_NBS" ~ "CDD SST-NBS",
covariate_removed== "yukon_mean_discharge" ~ "Yukon River - Mean Flow",
covariate_removed== "pollock_recruit_scale" ~ "Pollock Recruit. Index",
covariate_removed== "mean_size" ~ "Mean Spawner Size",
covariate_removed== "fall_snow_cummulative" ~ "Winter Snowpack"),
covariate_removed = factor(covariate_removed, levels = c("Mean Spawner Size","Winter Snowpack",
"CDD SST-NBS","Pollock Recruit. Index")),
variable = factor(variable, levels = c("Mean Spawner Size","Winter Snowpack",
"CDD SST-NBS",
"Pollock Recruit. Index","Chum Salmon Hatchery Release Abundance",
"Aleutian Winter Temperature")))  %>%
filter(!is.na(variable))
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff)
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
filter(stage == "Juvenile")
## plot Relative Diff ================
plota<- ggplot(data = joined_stage_a  %>% filter(stage == "Juvenile"),
aes(x=covariate_removed, y = relative_diff/100, color = variable#, shape = switch
)) +
geom_point()+
geom_hline(yintercept =0, linetype =2) +
theme_classic()+
scale_color_viridis(discrete = TRUE, name = "Covariate Sensitivity Response") +
ylab("Relative Difference") +
xlab("Covariate Removed") +
ggtitle("Stage A")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
plota
joined_stage_b <- left_join(stage_b_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(full_mod_median-reduced_mod_median)/full_mod_median,
relative_diff = (full_mod_median-reduced_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
filter(stage == "Marine") %>%
dplyr::mutate(switch = case_when(reduced_mod_median < 0 & full_mod_median < 0 ~ "N",
reduced_mod_median > 0 & full_mod_median > 0 ~ "N",
TRUE ~ "Y"),
covariate_removed = case_when(covariate_removed== "SST_CDD_Aleut" ~ "CDD SST-Aleut",
covariate_removed== "Chum_hatchery" ~ "Chum Hatchery Abund.",
covariate_removed== "full_index" ~ "Fullness Index"),
covariate_removed = factor(covariate_removed,
levels = c("Fullness Index","CDD SST-Aleut",
"Chum Hatchery Abund.")),
variable = factor(variable, levels = c("Fullness Index","CDD SST-Aleut",
"Chum Hatchery Abund."))) %>%
filter(!is.na(variable))
plotb<- ggplot(data = joined_stage_b %>% filter(stage == "Marine"),
aes(x=covariate_removed, y = percent_diff/100 , color = variable #, shape = switch
)) +
geom_point()+
geom_hline(yintercept =0, linetype =2) +
theme_classic()+
scale_color_viridis(discrete = TRUE,name = "Covariate Sensitivity Response") +
ylab("Relative Difference") +
xlab("Covariate Removed") +
ggtitle("Stage B") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
plotb
joined_stage_b <- left_join(stage_b_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(full_mod_median-reduced_mod_median)/full_mod_median,
relative_diff = (full_mod_median-reduced_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
filter(stage == "Marine")
View(joined_stage_b)
joined_stage_b <- left_join(stage_b_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(full_mod_median-reduced_mod_median)/full_mod_median,
relative_diff = (full_mod_median-reduced_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
filter(stage == "Marine") %>%
dplyr::mutate(switch = case_when(reduced_mod_median < 0 & full_mod_median < 0 ~ "N",
reduced_mod_median > 0 & full_mod_median > 0 ~ "N",
TRUE ~ "Y"),
covariate_removed = case_when(covariate_removed== "SST_CDD_Aleut" ~ "CDD SST-Aleut",
covariate_removed== "Chum_hatchery" ~ "Chum Hatchery Abund.",
covariate_removed== "full_index" ~ "Fullness Index"),
covariate_removed = factor(covariate_removed,
levels = c("Fullness Index","CDD SST-Aleut",
"Chum Hatchery Abund.")),
variable = factor(variable, levels = c("Fullness Index","CDD SST-Aleut",
"Chum Hatchery Abund.")))
joined_stage_b <- left_join(stage_b_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(full_mod_median-reduced_mod_median)/full_mod_median,
relative_diff = (full_mod_median-reduced_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
filter(stage == "Marine")
unique(joined_stage_b$variable)
joined_stage_b <- left_join(stage_b_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(full_mod_median-reduced_mod_median)/full_mod_median,
relative_diff = (full_mod_median-reduced_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
filter(stage == "Marine") %>%
dplyr::mutate(switch = case_when(reduced_mod_median < 0 & full_mod_median < 0 ~ "N",
reduced_mod_median > 0 & full_mod_median > 0 ~ "N",
TRUE ~ "Y"),
covariate_removed = case_when(covariate_removed== "SST_CDD_Aleut" ~ "CDD SST-Aleut",
covariate_removed== "Chum_hatchery" ~ "Chum Hatchery Abund.",
covariate_removed== "full_index" ~ "Fullness Index"),
variable = case_when(variable == "Chum Salmon Hatchery Release Abundance" ~"Chum Hatchery Abund.",
variable == "Aleutian Winter Temperature" ~ "CDD SST-Aleut",
TRUE ~ variable),
covariate_removed = factor(covariate_removed,
levels = c("Fullness Index","CDD SST-Aleut",
"Chum Hatchery Abund.")),
variable = factor(variable, levels = c("Fullness Index","CDD SST-Aleut",
"Chum Hatchery Abund."))) %>%
filter(!is.na(variable))
joined_stage_b <- left_join(stage_b_df,full_mod_df)
joined_stage_b <- left_join(stage_b_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(full_mod_median-reduced_mod_median)/full_mod_median,
relative_diff = (full_mod_median-reduced_mod_median)/sd_full)
joined_stage_b <- left_join(stage_b_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(full_mod_median-reduced_mod_median)/full_mod_median,
relative_diff = (full_mod_median-reduced_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
filter(stage == "Marine")
joined_stage_b <- left_join(stage_b_df,full_mod_df) %>%
filter(stage == "Marine")
View(full_mod)
View(full_mod_df)
View(stage_b_df)
joined_stage_b <- left_join(stage_b_df,full_mod_df)
full_mod_df <- as.data.frame(full_mod, pars = c(
"theta1[1]","theta1[2]","theta1[3]","theta1[4]",
"theta2[1]","theta2[2]","theta2[3]" )) %>%
dplyr::mutate(draw = 1:nrow(.)) %>%
gather(1:7, key = "rowname", value = "value") %>%
dplyr::mutate(variable = case_when(
rowname=="theta1[1]" ~ "Mean Return Size",
rowname=="theta1[2]" ~ "Winter Snowpack",
rowname=="theta1[3]" ~ "NBS July/August Temperature",
rowname=="theta1[4]" ~  "Pollock Recruitment",
rowname=="theta2[1]" ~ "Fullness Index",
rowname=="theta2[2]" ~ "Aleutian Winter Temperature",
rowname=="theta2[4]" ~ "Chum Salmon Hatchery Release Abundance"),
stage = case_when(variable %in% c( "Yukon River Mainstem Discharge",
"NBS July/August Temperature",
"Pollock Recruitment",
"Winter Snowpack",
"Mean Return Size") ~ "Juvenile",
variable %in% c("Aleutian Winter Temperature",
"Chum Salmon Hatchery Release Abundance",
"Fullness Index") ~ "Marine"))
# Calculate percent difference ======
# add that into stage DF as a full model metric
full_mod_df <- as.data.frame(full_mod, pars = c(
"theta1[1]","theta1[2]","theta1[3]","theta1[4]",
"theta2[1]","theta2[2]","theta2[3]" )) %>%
dplyr::mutate(draw = 1:nrow(.)) %>%
gather(1:7, key = "rowname", value = "value") %>%
dplyr::mutate(variable = case_when(
rowname=="theta1[1]" ~ "Mean Return Size",
rowname=="theta1[2]" ~ "Winter Snowpack",
rowname=="theta1[3]" ~ "NBS July/August Temperature",
rowname=="theta1[4]" ~  "Pollock Recruitment",
rowname=="theta2[1]" ~ "Fullness Index",
rowname=="theta2[2]" ~ "Aleutian Winter Temperature",
rowname=="theta2[4]" ~ "Chum Salmon Hatchery Release Abundance"),
stage = case_when(variable %in% c( "Yukon River Mainstem Discharge",
"NBS July/August Temperature",
"Pollock Recruitment",
"Winter Snowpack",
"Mean Return Size") ~ "Juvenile",
variable %in% c("Aleutian Winter Temperature",
"Chum Salmon Hatchery Release Abundance",
"Fullness Index") ~ "Marine")) %>%
group_by(stage,variable) %>%
dplyr::summarise(full_mod_median = median(value),
sd_full = sd(value))
# Calculate percent difference ======
# add that into stage DF as a full model metric
full_mod_df <- as.data.frame(full_mod, pars = c(
"theta1[1]","theta1[2]","theta1[3]","theta1[4]",
"theta2[1]","theta2[2]","theta2[3]" )) %>%
dplyr::mutate(draw = 1:nrow(.)) %>%
gather(1:7, key = "rowname", value = "value") %>%
dplyr::mutate(variable = case_when(
rowname=="theta1[1]" ~ "Mean Return Size",
rowname=="theta1[2]" ~ "Winter Snowpack",
rowname=="theta1[3]" ~ "NBS July/August Temperature",
rowname=="theta1[4]" ~  "Pollock Recruitment",
rowname=="theta2[1]" ~ "Fullness Index",
rowname=="theta2[2]" ~ "Aleutian Winter Temperature",
rowname=="theta2[3]" ~ "Chum Salmon Hatchery Release Abundance"),
stage = case_when(variable %in% c( "Yukon River Mainstem Discharge",
"NBS July/August Temperature",
"Pollock Recruitment",
"Winter Snowpack",
"Mean Return Size") ~ "Juvenile",
variable %in% c("Aleutian Winter Temperature",
"Chum Salmon Hatchery Release Abundance",
"Fullness Index") ~ "Marine")) %>%
group_by(stage,variable) %>%
dplyr::summarise(full_mod_median = median(value),
sd_full = sd(value))
stage_a_df <- rbind(plot_sensitivity_a[[1]][[2]],plot_sensitivity_a[[2]][[2]],plot_sensitivity_a[[3]][[2]],plot_sensitivity_a[[4]][[2]])
stage_b_df <- rbind(plot_sensitivity_b[[1]][[2]],plot_sensitivity_b[[2]][[2]],plot_sensitivity_b[[3]][[2]])
## DFs with percent and relative diff  =======
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
filter(stage == "Juvenile") %>%
dplyr::mutate(switch = case_when(reduced_mod_median < 0 & full_mod_median <0 ~ "N",
reduced_mod_median > 0 & full_mod_median >0 ~ "N",
TRUE ~ "Y"),
covariate_removed = case_when(covariate_removed== "SST_CDD_NBS" ~ "CDD SST-NBS",
covariate_removed== "yukon_mean_discharge" ~ "Yukon River - Mean Flow",
covariate_removed== "pollock_recruit_scale" ~ "Pollock Recruit. Index",
covariate_removed== "mean_size" ~ "Mean Spawner Size",
covariate_removed== "fall_snow_cummulative" ~ "Winter Snowpack"),
covariate_removed = factor(covariate_removed, levels = c("Mean Spawner Size","Winter Snowpack",
"CDD SST-NBS","Pollock Recruit. Index")),
variable = factor(variable, levels = c("Mean Spawner Size","Winter Snowpack",
"CDD SST-NBS",
"Pollock Recruit. Index","Chum Salmon Hatchery Release Abundance",
"Aleutian Winter Temperature")))  %>%
filter(!is.na(variable))
joined_stage_b <- left_join(stage_b_df,full_mod_df) %>%
filter(stage == "Marine") %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(full_mod_median-reduced_mod_median)/full_mod_median,
relative_diff = (full_mod_median-reduced_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
dplyr::mutate(switch = case_when(reduced_mod_median < 0 & full_mod_median < 0 ~ "N",
reduced_mod_median > 0 & full_mod_median > 0 ~ "N",
TRUE ~ "Y"),
covariate_removed = case_when(covariate_removed== "SST_CDD_Aleut" ~ "CDD SST-Aleut",
covariate_removed== "Chum_hatchery" ~ "Chum Hatchery Abund.",
covariate_removed== "full_index" ~ "Fullness Index"),
variable = case_when(variable == "Chum Salmon Hatchery Release Abundance" ~"Chum Hatchery Abund.",
variable == "Aleutian Winter Temperature" ~ "CDD SST-Aleut",
TRUE ~ variable),
covariate_removed = factor(covariate_removed,
levels = c("Fullness Index","CDD SST-Aleut",
"Chum Hatchery Abund.")),
variable = factor(variable, levels = c("Fullness Index","CDD SST-Aleut",
"Chum Hatchery Abund."))) %>%
filter(!is.na(variable))
## plot Relative Diff ================
plota<- ggplot(data = joined_stage_a  %>% filter(stage == "Juvenile"),
aes(x=covariate_removed, y = relative_diff/100, color = variable#, shape = switch
)) +
geom_point()+
geom_hline(yintercept =0, linetype =2) +
theme_classic()+
scale_color_viridis(discrete = TRUE, name = "Covariate Sensitivity Response") +
ylab("Relative Difference") +
xlab("Covariate Removed") +
ggtitle("Stage A")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
plota
plotb<- ggplot(data = joined_stage_b %>% filter(stage == "Marine"),
aes(x=covariate_removed, y = percent_diff/100 , color = variable #, shape = switch
)) +
geom_point()+
geom_hline(yintercept =0, linetype =2) +
theme_classic()+
scale_color_viridis(discrete = TRUE,name = "Covariate Sensitivity Response") +
ylab("Relative Difference") +
xlab("Covariate Removed") +
ggtitle("Stage B") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
plotb
View(joined_stage_b)
plotb<- ggplot(data = joined_stage_b ,
aes(x=covariate_removed, y = percent_diff/100 , color = variable #, shape = switch
)) +
geom_point()+
geom_hline(yintercept =0, linetype =2) +
theme_classic()+
scale_color_viridis(discrete = TRUE,name = "Covariate Sensitivity Response") +
ylab("Relative Difference") +
xlab("Covariate Removed") +
ggtitle("Stage B") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
plotb
## plot Relative Diff ================
plota<- ggplot(data = joined_stage_a ,
aes(x=covariate_removed, y = relative_diff/100, color = variable#, shape = switch
)) +
geom_point()+
geom_hline(yintercept =0, linetype =2) +
theme_classic()+
scale_color_viridis(discrete = TRUE, name = "Covariate Sensitivity Response") +
ylab("Relative Difference") +
xlab("Covariate Removed") +
ggtitle("Stage A")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
plota
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
filter(stage == "Juvenile") %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff)
## DFs with percent and relative diff  =======
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
filter(stage == "Juvenile") %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
dplyr::mutate(
covariate_removed = case_when(covariate_removed== "SST_CDD_NBS" ~ "CDD SST-NBS",
covariate_removed== "pollock_recruit_scale" ~ "Pollock Recruit. Index",
covariate_removed== "mean_size" ~ "Mean Spawner Size",
covariate_removed== "fall_snow_cummulative" ~ "Winter Snowpack"),
covariate_removed = factor(covariate_removed, levels = c("Mean Spawner Size","Winter Snowpack",
"CDD SST-NBS","Pollock Recruit. Index")),
variable = factor(variable, levels = c("Mean Spawner Size","Winter Snowpack",
"CDD SST-NBS","Pollock Recruit. Index")))  %>%
filter(!is.na(variable))
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
filter(stage == "Juvenile") %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff)
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
filter(stage == "Juvenile") %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
dplyr::mutate(
covariate_removed = case_when(covariate_removed== "SST_CDD_NBS" ~ "CDD SST-NBS",
covariate_removed== "pollock_recruit_scale" ~ "Pollock Recruit. Index",
covariate_removed== "mean_size" ~ "Mean Spawner Size",
covariate_removed== "fall_snow_cummulative" ~ "Winter Snowpack"))
## DFs with percent and relative diff  =======
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
filter(stage == "Juvenile") %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
dplyr::mutate(
covariate_removed = case_when(covariate_removed== "SST_CDD_NBS" ~ "CDD SST-NBS",
covariate_removed== "pollock_recruit_scale" ~ "Pollock Recruit. Index",
covariate_removed== "mean_size" ~ "Mean Return Size",
covariate_removed== "fall_snow_cummulative" ~ "Winter Snowpack"))
covariate_removed = factor(covariate_removed, levels = c("Mean Return Size","Winter Snowpack",
"CDD SST-NBS","Pollock Recruit. Index")),
## DFs with percent and relative diff  =======
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
filter(stage == "Juvenile") %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
dplyr::mutate(
covariate_removed = case_when(covariate_removed== "SST_CDD_NBS" ~ "CDD SST-NBS",
covariate_removed== "pollock_recruit_scale" ~ "Pollock Recruit. Index",
covariate_removed== "mean_size" ~ "Mean Return Size",
covariate_removed== "fall_snow_cummulative" ~ "Winter Snowpack"))
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
filter(stage == "Juvenile") %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
dplyr::mutate(
covariate_removed = case_when(covariate_removed== "SST_CDD_NBS" ~ "CDD SST-NBS",
covariate_removed== "pollock_recruit_scale" ~ "Pollock Recruitment",
covariate_removed== "mean_size" ~ "Mean Return Size",
covariate_removed== "fall_snow_cummulative" ~ "Winter Snowpack"),
variable = case_when(variable == "NBS July/August Temperature" ~ "CDD SST-NBS",
TRUE ~ variable))
## DFs with percent and relative diff  =======
joined_stage_a <- left_join(stage_a_df,full_mod_df) %>%
filter(stage == "Juvenile") %>%
dplyr::mutate(abs_diff =(reduced_mod_median-full_mod_median),
percent_diff =(reduced_mod_median-full_mod_median)/full_mod_median,
relative_diff = (reduced_mod_median-full_mod_median)/sd_full) %>%
dplyr::select(stage,variable, covariate_removed,percent_diff,relative_diff,reduced_mod_median, full_mod_median,
abs_diff) %>%
dplyr::mutate(
covariate_removed = case_when(covariate_removed== "SST_CDD_NBS" ~ "CDD SST-NBS",
covariate_removed== "pollock_recruit_scale" ~ "Pollock Recruitment",
covariate_removed== "mean_size" ~ "Mean Return Size",
covariate_removed== "fall_snow_cummulative" ~ "Winter Snowpack"),
variable = case_when(variable == "NBS July/August Temperature" ~ "CDD SST-NBS",
TRUE ~ variable),
covariate_removed = factor(covariate_removed, levels = c("Mean Return Size","Winter Snowpack",
"CDD SST-NBS","Pollock Recruitment")),
variable = factor(variable, levels = c("Mean Return Size","Winter Snowpack",
"CDD SST-NBS","Pollock Recruitment")))
## plot Relative Diff ================
plota<- ggplot(data = joined_stage_a ,
aes(x=covariate_removed, y = relative_diff/100, color = variable#, shape = switch
)) +
geom_point()+
geom_hline(yintercept =0, linetype =2) +
theme_classic()+
scale_color_viridis(discrete = TRUE, name = "Covariate Sensitivity Response") +
ylab("Relative Difference") +
xlab("Covariate Removed") +
ggtitle("Stage A")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
plota
## plot Relative Diff ================
plota<- ggplot(data = joined_stage_a ,
aes(x=covariate_removed, y = relative_diff/100, color = variable#, shape = switch
)) +
geom_point()+
geom_hline(yintercept =0, linetype =2) +
theme_classic()+
scale_color_viridis(discrete = TRUE, name = "Covariate Sensitivity Response") +
ylab("Relative Difference") +
xlab("Covariate Removed") +
ggtitle("Stage A")+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
plota
ggsave("output/Plot_StageA_percentDiff.png", width = 6, height = 3)
plotb<- ggplot(data = joined_stage_b ,
aes(x=covariate_removed, y = percent_diff/100 , color = variable #, shape = switch
)) +
geom_point()+
geom_hline(yintercept =0, linetype =2) +
theme_classic()+
scale_color_viridis(discrete = TRUE,name = "Covariate Sensitivity Response") +
ylab("Relative Difference") +
xlab("Covariate Removed") +
ggtitle("Stage B") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
plotb
ggsave("output/Plot_StageB_percentDiff.png", width = 8, height = 5)
# Look here for saved manuscript plot =================
ggpubr::ggarrange(plota, plotb, labels = c("A.", "B."),ncol = 2)
ggsave("output/Plot_Supplement_Covariate_Sensitivity.png", width = 10, height = 4)
